<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0">
    <meta name="csrf-token" content="Z1TDf2Ry9mZJa023S4AkNiJ91iMcaKDoN4N4Pa2I">
    <!-- CSRF Token -->

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="stylesheet" href="https://aleum.kr/assets/plugins/sweetalert2/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://aleum.kr/assets/css/app/main.css">
    <link rel="stylesheet" href="https://aleum.kr/assets/css/app.css?v=e53dccf-dirty ">


    <script src="https://partner.googleadservices.com/gampad/cookie.js?domain=aleum.kr&amp;callback=_gfp_s_&amp;client=ca-pub-3305422501449778&amp;cookie=ID%3Df0963cf3879b0586-22e6de6b96cf00bc%3AT%3D1640796354%3ART%3D1640796354%3AS%3DALNI_MbLB6ND2FxM2SilReOT-m15AYvMMw"></script>
    <script src="https://pagead2.googlesyndication.com/pagead/managed/js/adsense/m202112060101/show_ads_impl_fy2019.js" id="google_shimpl"></script>
    <script src="https://aleum.kr/assets/plugins//jquery-1.10.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>

    <script src="https://aleum.kr/assets/js/util.js"></script>
    <script src="https://aleum.kr/assets/js/app.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/moonspam/NanumSquare@1.0/nanumsquare.css">

    <script src="https://browser.sentry-cdn.com/6.4.1/bundle.min.js" integrity="sha384-THoc7rflwZFKTdZNgv6jLFFDn299Uv3t1SW5B4yGLvLiCRTYP9ys6vXZcMl95TQF" crossorigin="anonymous"></script>
    <script>
        Sentry.init({
            dsn: "https://ac66ea538c8b48c08c5df154682dc1a2@o720709.ingest.sentry.io/5790391"
        });
    </script>
    <script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3305422501449778" crossorigin="anonymous" data-checked-head="true"></script>
    <meta http-equiv="origin-trial" content="AxujKG9INjsZ8/gUq8+dTruNvk7RjZQ1oFhhgQbcTJKDnZfbzSTE81wvC2Hzaf3TW4avA76LTZEMdiedF1vIbA4AAABueyJvcmlnaW4iOiJodHRwczovL2ltYXNkay5nb29nbGVhcGlzLmNvbTo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2NTI3NzQ0MDAsImlzVGhpcmRQYXJ0eSI6dHJ1ZX0=">
    <meta http-equiv="origin-trial" content="Azuce85ORtSnWe1MZDTv68qpaW3iHyfL9YbLRy0cwcCZwVnePnOmkUJlG8HGikmOwhZU22dElCcfrfX2HhrBPAkAAAB7eyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2NTI3NzQ0MDAsImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9">
    <meta http-equiv="origin-trial" content="A16nvcdeoOAqrJcmjLRpl1I6f3McDD8EfofAYTt/P/H4/AWwB99nxiPp6kA0fXoiZav908Z8etuL16laFPUdfQsAAACBeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2NTI3NzQ0MDAsImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9">
    <meta http-equiv="origin-trial" content="AxBHdr0J44vFBQtZUqX9sjiqf5yWZ/OcHRcRMN3H9TH+t90V/j3ENW6C8+igBZFXMJ7G3Pr8Dd13632aLng42wgAAACBeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2NTI3NzQ0MDAsImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9">
    <meta http-equiv="origin-trial" content="A88BWHFjcawUfKU3lIejLoryXoyjooBXLgWmGh+hNcqMK44cugvsI5YZbNarYvi3roc1fYbHA1AVbhAtuHZflgEAAAB2eyJvcmlnaW4iOiJodHRwczovL2dvb2dsZS5jb206NDQzIiwiZmVhdHVyZSI6IlRydXN0VG9rZW5zIiwiZXhwaXJ5IjoxNjUyNzc0NDAwLCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ==">
    <meta http-equiv="origin-trial" content="A8FHS1NmdCwGqD9DwOicnHHY+y27kdWfxKa0YHSGDfv0CSpDKRHTQdQmZVPDUdaFWUsxdgVxlwAd6o+dhJykPA0AAACWeyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiQ29udmVyc2lvbk1lYXN1cmVtZW50IiwiZXhwaXJ5IjoxNjQzMTU1MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlLCJ1c2FnZSI6InN1YnNldCJ9">
    <meta http-equiv="origin-trial" content="A8zdXi6dr1hwXEUjQrYiyYQGlU3557y5QWDnN0Lwgj9ePt66XMEvNkVWOEOWPd7TP9sBQ25X0Q15Lr1Nn4oGFQkAAACceyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiQ29udmVyc2lvbk1lYXN1cmVtZW50IiwiZXhwaXJ5IjoxNjQzMTU1MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlLCJ1c2FnZSI6InN1YnNldCJ9">
    <meta http-equiv="origin-trial" content="A4/Htern2udN9w3yJK9QgWQxQFruxOXsXL7cW60DyCl0EZFGCSme/J33Q/WzF7bBkVvhEWDlcBiUyZaim5CpFQwAAACceyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiQ29udmVyc2lvbk1lYXN1cmVtZW50IiwiZXhwaXJ5IjoxNjQzMTU1MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlLCJ1c2FnZSI6InN1YnNldCJ9">
    <link rel="preload" href="https://adservice.google.co.kr/adsid/integrator.js?domain=aleum.kr" as="script">
    <script type="text/javascript" src="https://adservice.google.co.kr/adsid/integrator.js?domain=aleum.kr"></script>
    <link rel="preload" href="https://adservice.google.com/adsid/integrator.js?domain=aleum.kr" as="script">
    <script type="text/javascript" src="https://adservice.google.com/adsid/integrator.js?domain=aleum.kr"></script>
</head>


<body class="note-show t-line">
    <div id="app">
        <header>
            <div class="d-flex justify-content-between">
                <nav class="navbar navbar-expand-lg"><a href="javascript:;" class="navbar-brand"><button type="button" class="btn-link btn-back"><img src="/assets/img/app/icon_back.png" alt=""></button></a> <span class="text_logo">앱닥터테스트1</span></nav>
                <div class="navright d-flex align-center"></div>
            </div>
        </header>
        <div id="main" class="main">
            <section id="note_wrap" class="pb-2">
                <div class="chat">
                    <!---->
                    <div class="right_chat">
                        <div class="grid col-11 offset-1 pr-0">
                            <div class="d-flex justify-content-end mb-3"><strong class="mr-3"> 22:24</strong>
                                <!---->
                            </div>
                            <div class="d-flex justify-content-end mb-3">
                                <a href="/note-image/30/1188" target="_blank"><img src="/storage/messages/572c2339f8a795ac2ab8aa1b00629e04.jpg" alt="" class="img_chat"></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chat">
                    <!---->
                    <div class="right_chat">
                        <div class="grid col-11 offset-1 pr-0">
                            <div class="d-flex justify-content-end mb-3"><strong class="mr-3"> 15:38</strong>
                                <div class="content_chat">
                                    <span>
                                            Fdsfdsf
                                    </span>
                                </div>
                            </div>
                            <!---->
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <footer>
            <form action="">
                <div class="input_chat">
                    <div class="d-flex col-12 pl-0 pr-0"><input type="file" name="image" id="image" accept="image/png,image/jpeg" class="hidden"> <button type="button" class="btn-link"><img src="/assets/img/app/icon_plus_button.png" alt=""></button>
                        <div class="input_text"><textarea rows="1" data-min-rows="0" id="message" name="message" class="autoExpand"></textarea> <button type="button" class="btn-link btn-send-chat">등록</button></div>
                    </div>
                </div>
            </form>
        </footer>
        <div class="backdrop" style="display: none;">
            <div id="loading"></div>
        </div>
    </div>

    <script src="https://aleum.kr/assets/js/jsbridge.js?v=e53dccf-dirty"></script>
    <script src="https://aleum.kr/assets/plugins/sweetalert2/dist/sweetalert2.min.js"></script>
    <script>
        axios.post('/api/users/push-messages/get-count').then(response => {
            if (response.data.count.unread > 0) {
                $('.notification').addClass('unread');
            }
        });

        //쪽지
        axios.post('/api/messages/get-unread-count').then(response => {
            if (response.data.unread_count > 0) {
                $('.list_footer a#note').addClass('unread');
            } else {
                $('.list_footer a#note').removeClass('unread');
            }
        })
    </script>
    <script src="https://aleum.kr/assets/js/vue.js"></script>
    <script>
        let interval = 3000;
        let app = new Vue({
            el: '#app',
            data() {
                return {
                    offset: 0,
                    init: false,
                    receiver_id: '30',
                    lists: {
                        data: []
                    }
                }
            },
            mounted() {
                Loader.show();
                this.load();
            },
            watch: {
                lists: {
                    deep: true,
                    handler() {
                        if (app.init) {
                            app.toBottom($('#main').prop('scrollHeight'), 500);
                        } else {
                            setTimeout(function() {
                                $('#main').animate({
                                    scrollTop: $('#main').prop('scrollHeight')
                                }, 0);
                            }, 500);
                            app.init = true;
                        }
                    }
                }
            },
            methods: {
                load: function() {
                    axios.get('/api/messages/chat-user/' + this.receiver_id + '?read=Y&offset=' + this.offset).then(response => {

                        if (!this.init) {
                            app.lists = response.data;
                            Loader.hide();
                            app.toBottom($('body').prop('scrollHeight'), 500);

                        } else {
                            if (response.data.meta.total > 0) {
                                $.each(response.data.data, function(i, e) {
                                    app.lists.data.push(e);
                                });
                            }
                        }

                        if (response.data.meta.total > 0) {
                            let last = Object.keys(response.data.data).pop();
                            this.offset = response.data.data[last].id;
                        }
                    });
                },
                toBottom: function(top, second) {
                    //console.log(top);
                    setTimeout(function() {
                        $('#main').animate({
                            scrollTop: top
                        }, second);
                    }, 100);
                },
                send: function(flag) {
                    if (flag != 'image') {
                        let message = $('#message').val();
                        if (!message) return false;
                    }

                    const form = document.querySelector("form");
                    let formdata = new FormData(form);
                    axios.post('/api/messages/chat-user/' + this.receiver_id, formdata).then(response => {
                        this.lists.data.push(response.data.data);
                        this.offset = response.data.data.id;
                        $('#message').val('');
                        form.reset();
                    })
                },
                remove: function(chat_id, e) {
                    e.stopPropagation();
                    let ele = $(e.target).closest('.content_chat');

                    ele.addClass('selected');
                    Alert.confirm('삭제하시겠습니까?<br>삭제 시 상대방의 쪽지함에서도 삭제되어집니다.', '', function() {

                        axios.delete('/api/messages/' + chat_id).then(response => {
                            if (response.data.success) {
                                ele.closest('.right_chat').fadeOut(100);
                            } else {

                            }
                            console.log(response);
                        })
                    }, function() {
                        ele.removeClass('selected');
                    })

                },
                img: function() {
                    $('#image').trigger('click');
                },
                report: function() {
                    //나가기
                    axios.delete('/api/messages/chat-user/' + this.receiver_id).then(response => {
                        if (response.data.success) {
                            document.location.href = "/note";
                        }
                    });
                },
                resize: function(evt) {
                    let chat = $('.chat > div').last().position();
                    this.toBottom($('#main').prop('scrollHeight'), 500);
                }
            }
        });
    </script>

</body>

</html>